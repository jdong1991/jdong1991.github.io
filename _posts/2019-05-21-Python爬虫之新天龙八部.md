---
layout:     post
title:      Python爬虫之新天龙八部
subtitle:   
date:       2019-05-21
author:     JD
header-img: img/post-jd-spider3.jpg
catalog: true
tags:
    - spider
    - requests
    - BeautifulSoup
---

## 背景

新天龙八部已经是十二年的老游戏，但我对它的热情不减当年。不过，游戏内的人已经走了一批又一批，游戏账号在一批批人的打造中加强了许多。这里主要是爬取全部服务器排行前50的角色装备评分，并做一个简单的分析。

## 排行榜

它的[排行榜页面](http://twjh.changyou.com/html/paihang/zd.shtml)也比较特别。可以看它源代码。

![](http://wx4.sinaimg.cn/mw690/006F1DTzgy1g3c4luam1cj30j90di3yp.jpg)

但是渲染后，可以看到

![](http://wx3.sinaimg.cn/mw690/006F1DTzgy1g3c4lrkyg9j30j20e4wf5.jpg)

这说明，它是异步的，我们需要找到传输给前端的选项文件。

依旧是打开`Chrome`，进入排行榜页面，按下`F12`，点击`Network`，选择`XHR`。重新刷新页面，会发现

![](http://wx4.sinaimg.cn/mw690/006F1DTzgy1g3c4lxr1ksj30l40csjsf.jpg)

看到`srvlist.txt`文件，里面有乱码，但是看格式貌似就是我们想要的。

好的，转下编码看下，发现正是所需`option`信息。

首先获取`srvlist.txt`文件。

![](http://wx4.sinaimg.cn/mw690/006F1DTzgy1g3c4qviyuzj30km0br3z8.jpg)

发现`Request URL`有记录获取地址

    import requests
    import pandas as pd
    
    srvlist_url = "http://twjh.changyou.com/html/tldata/srvlist.txt"
    headers = {
                'User-Agent': ('Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36'
                               ' (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36')
    }
    r = requests.get(srvlist_url, headers=headers)
    r.encoding = 'utf-8'
    sers = r.text
    df = pd.DataFrame([ser.split(',') for ser in sers.split('\n')[:-1]],
                      columns=['daqu', 'qu', 'id'])
    df.head()

||daqu|qu|id|
|:-|:-|:-|-:|
|0|东部电信|九阴真经|38|
|1|东部电信|玉女心经|154|
|2|东部电信|北冥神功|65|
|3|东部电信|雁翎枪|65|
|4|东部电信|七伤拳|9140|

![](http://wx4.sinaimg.cn/mw690/006F1DTzgy1g3c4m006kwj30x80gsdi2.jpg)



## 排名分析


## 总结